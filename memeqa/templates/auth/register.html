<!-- templates/register.html -->
{% extends "base.html" %}

{% block title %}Register - MemeQA{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="text-center mb-5">
            <h1>üéì Join the Research</h1>
            <p class="lead">Register to track your contributions and get updates on research findings</p>
        </div>
        
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üë§ Researcher Registration</h4>
            </div>
            <div class="card-body">
                <form method="post" id="registrationForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="name" name="name" required 
                                   placeholder="Your full name">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="email" name="email" required 
                                   placeholder="your@email.com">
                            <div class="form-text">We'll send you a login link instead of using passwords</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="country" class="form-label">Country <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="country" name="country" list="country-list" 
                                   placeholder="Type or select your country" required>
                            <datalist id="country-list">
                                {% for country in config.COUNTRIES %}
                                    <option value="{{ country }}">
                                {% endfor %}
                            </datalist>
                            <div class="form-text">Start typing for suggestions.</div>
                            <div class="invalid-feedback" id="country-error">Please select a valid country from the list.</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Languages <span class="text-danger">*</span></label>
                            <div id="languages-container" class="form-check-list" style="max-height: 150px; overflow-y: auto; border: 1px solid #ced4da; padding: 10px; border-radius: 4px;">
                                {% for language in config.LANGUAGES %}
                                    <div class="form-check">
                                        <input class="form-check-input language-checkbox" type="checkbox" name="languages" value="{{ language }}" id="language-{{ language|lower|replace(' ', '-') }}">
                                        <label class="form-check-label" for="language-{{ language|lower|replace(' ', '-') }}">
                                            {{ language }}
                                        </label>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="invalid-feedback" id="languages-error">Please select at least one language.</div>
                            <div class="form-text">Select one or more languages you speak.</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="birth_year" class="form-label">Birth Year <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="birth_year" name="birth_year" 
                                   placeholder="e.g., 1995" min="1900" max="2025" required>
                            <div class="form-text">Enter the year you were born.</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="affiliation" class="form-label">Affiliation <span class="text-muted">(optional)</span></label>
                            <input type="text" class="form-control" id="affiliation" name="affiliation" 
                                   placeholder="University, Company, etc.">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="research_interest" class="form-label">Research Interest <span class="text-muted">(optional)</span></label>
                            <select class="form-select" id="research_interest" name="research_interest">
                                <option value="">Select your primary interest...</option>
                                <option value="Vision-Language Models">Vision-Language Models</option>
                                <option value="Cultural AI">Cultural AI</option>
                                <option value="Computational Humor">Computational Humor</option>
                                <option value="Internet Culture">Internet Culture</option>
                                <option value="AI Benchmarking">AI Benchmarking</option>
                                <option value="Multimodal Learning">Multimodal Learning</option>
                                <option value="Social Media Analysis">Social Media Analysis</option>
                                <option value="Human-AI Interaction">Human-AI Interaction</option>
                                <option value="General AI Research">General AI Research</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">Notification Preferences</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notify_updates" name="notify_updates" checked>
                            <label class="form-check-label" for="notify_updates">
                                üì¨ Send me updates about research findings and publications
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notify_milestones" name="notify_milestones" checked>
                            <label class="form-check-label" for="notify_milestones">
                                üéØ Notify me when we reach dataset milestones
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="data_access" name="data_access">
                            <label class="form-check-label" for="data_access">
                                üìä I'm interested in accessing the research dataset
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="privacy_agreement" name="privacy_agreement" required>
                            <label class="form-check-label" for="privacy_agreement">
                                <strong>Privacy Agreement:</strong> I understand that my email will only be used for 
                                research updates and will not be shared with third parties. I can unsubscribe at any time. 
                                <span class="text-danger">*</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitButton">
                            üöÄ Join the Research
                        </button>
                        <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
                            Continue as Anonymous
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h5 class="card-title">üéÅ Benefits of Registering</h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li>üìä Track your contribution statistics</li>
                            <li>üìù Get cited in research publications</li>
                            <li>üìß Receive research updates and findings</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li>üèÜ Recognition for major contributions</li>
                            <li>üìö Early access to research papers</li>
                            <li>ü§ù Connect with other researchers</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simple Login Option -->
        <div class="card shadow-sm mt-4 bg-light">
            <div class="card-body">
                <h5 class="card-title">üîë Already Registered?</h5>
                <p class="card-text">Enter your email to get a login link sent to you:</p>
                <form method="post" action="{{ url_for('auth.request_login') }}" class="row g-3">
                    <div class="col-auto flex-grow-1">
                        <input type="email" class="form-control" name="login_email" placeholder="your@email.com" required>
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-outline-primary">Send Login Link</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Form validation and enhancement
document.getElementById('registrationForm').addEventListener('submit', function(e) {
    let isValid = true;

    const email = document.getElementById('email').value;
    const name = document.getElementById('name').value;
    const countryInput = document.getElementById('country');
    const country = countryInput.value;
    const languagesCheckboxes = document.querySelectorAll('.language-checkbox:checked');
    const birthYear = document.getElementById('birth_year').value;
    const languagesContainer = document.getElementById('languages-container');
    const submitBtn = document.getElementById('submitButton');
    
    // Validate country
    const validCountries = Array.from(document.querySelectorAll('#country-list option')).map(opt => opt.value);
    if (country && !validCountries.includes(country)) {
        countryInput.classList.add('is-invalid');
        document.getElementById('country-error').style.display = 'block';
        isValid = false;
    } else {
        countryInput.classList.remove('is-invalid');
        document.getElementById('country-error').style.display = 'none';
    }
    
    // Validate at least one language
    if (languagesCheckboxes.length === 0) {
        languagesContainer.classList.add('is-invalid');
        document.getElementById('languages-error').style.display = 'block';
        isValid = false;
    } else {
        languagesContainer.classList.remove('is-invalid');
        document.getElementById('languages-error').style.display = 'none';
    }
    
    if (!email || !name || !country || !birthYear) {
        isValid = false;
    }
    
    if (!document.getElementById('privacy_agreement').checked) {
        alert('Please agree to the privacy terms to continue.');
        isValid = false;
    }
    
    // Validate birth year
    if (birthYear) {
        const year = parseInt(birthYear);
        const currentYear = new Date().getFullYear();
        if (year < 1900 || year > currentYear) {
            alert('Please enter a valid birth year between 1900 and ' + currentYear + '.');
            isValid = false;
        }
    }
    
    if (!isValid) {
        e.preventDefault();
        alert('Please fill in all required fields, including at least one language.');
        return false;
    }
    
    // Only disable button and show registering state if all validations pass
    submitBtn.innerHTML = '‚è≥ Registering...';
    submitBtn.disabled = true;
});

// Email validation on blur
document.getElementById('email').addEventListener('blur', function() {
    const email = this.value;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (email && !emailRegex.test(email)) {
        this.classList.add('is-invalid');
        if (!this.nextElementSibling || !this.nextElementSibling.classList.contains('invalid-feedback')) {
            const feedback = document.createElement('div');
            feedback.className = 'invalid-feedback';
            feedback.textContent = 'Please enter a valid email address.';
            this.parentNode.appendChild(feedback);
        }
    } else {
        this.classList.remove('is-invalid');
        const feedback = this.parentNode.querySelector('.invalid-feedback');
        if (feedback) feedback.remove();
    }
});

// Country validation on blur
document.getElementById('country').addEventListener('blur', function() {
    const country = this.value;
    const validCountries = Array.from(document.querySelectorAll('#country-list option')).map(opt => opt.value);
    if (country && !validCountries.includes(country)) {
        this.classList.add('is-invalid');
        document.getElementById('country-error').style.display = 'block';
    } else {
        this.classList.remove('is-invalid');
        document.getElementById('country-error').style.display = 'none';
    }
});

// Language validation on checkbox change
document.querySelectorAll('.language-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const languagesCheckboxes = document.querySelectorAll('.language-checkbox:checked');
        const languagesContainer = document.getElementById('languages-container');
        if (languagesCheckboxes.length === 0) {
            languagesContainer.classList.add('is-invalid');
            document.getElementById('languages-error').style.display = 'block';
        } else {
            languagesContainer.classList.remove('is-invalid');
            document.getElementById('languages-error').style.display = 'none';
        }
    });
});
</script>
{% endblock %}