{% extends "base.html" %}

{% block title %}Upload Meme - MemeQA Enhanced{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-9">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üì§ Upload & Classify Meme</h1>
            <span class="badge bg-info fs-6">Enhanced Data Collection</span>
        </div>
        
        <p class="lead mb-4">Help us build a comprehensive meme understanding dataset by providing detailed classification information.</p>
        
        <!-- Validation Alerts Container -->
        <div id="validation-alerts" class="mb-3"></div>
        
        <form method="post" enctype="multipart/form-data" id="memeUploadForm">
            <!-- User Information Section -->
            {% if not current_user %}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üë§ Contributor Information</h4>
                    <small>Already have an account? <a href="#" class="text-white" data-bs-toggle="modal" data-bs-target="#loginModal"><u>Sign in here</u></a></small>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="contributor_name" class="form-label">Name/Username <span class="text-muted">(optional)</span></label>
                            <input type="text" class="form-control" id="contributor_name" name="contributor_name" 
                                   placeholder="Your name or username" value="{{ form_data.contributor_name if form_data else '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="contributor_email" class="form-label">Email <span class="text-muted">(optional, for research updates)</span></label>
                            <input type="email" class="form-control" id="contributor_email" name="contributor_email" 
                                   placeholder="your@email.com" value="{{ form_data.contributor_email if form_data else '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="contributor_country" class="form-label">Country <span class="text-danger">*</span></label>
                            <select class="form-select" id="contributor_country" name="contributor_country" required>
                                <option value="">Select your country...</option>
                                {% if config.COUNTRIES is defined %}
                                    {% for option in config.COUNTRIES %}
                                        <option value="{{ option }}" {{ 'selected' if form_data and form_data.contributor_country == option else '' }}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                {% else %}
                                    <option value="Unknown" selected>Error: COUNTRIES not defined</option>
                                {% endif %}
                            </select>
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Meme Upload Section-->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">üñºÔ∏è Meme Image</h4>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="file" class="form-label">Choose Meme <span class="text-danger">*</span></label>
                        <input type="file" class="form-control" id="file" name="file" 
                               accept={{config.ACCEPT_FILE_TYPES}} required>
                        <div class="form-text">Supported formats: {{ config.ALLOWED_EXTENSIONS | map('upper') | join(', ') }} (max 16MB)</div>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="meme_origin_country" class="form-label">Meme Origin Country <span class="text-danger">*</span></label>
                            <select class="form-select" id="meme_origin_country" name="meme_origin_country" required>
                                <option value="">Select Meme Country Origin...</option>
                                {% if config.COUNTRIES_MEMES is defined %}
                                    {% for option in config.COUNTRIES_MEMES %}
                                        <option value="{{ option }}" {{ 'selected' if form_data and form_data.meme_origin_country == option else '' }}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                {% else %}
                                    <option value="Unknown" selected>Error: COUNTRIES not defined</option>
                                {% endif %}
                            </select>
                            <div class="invalid-feedback"></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="platform_found" class="form-label">Platform Where Found <span class="text-danger">*</span></label>
                            <select class="form-select" id="platform_found" name="platform_found" required>
                                <option value="">Select Platform...</option>
                                {% if config.PLATFORM_OPTIONS is defined %}
                                    {% for option in config.PLATFORM_OPTIONS %}
                                        <option value="{{ option }}" {{ 'selected' if form_data and form_data.platform_found == option else '' }}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                {% else %}
                                    <option value="Unknown" selected>Error: PLATFORM_OPTIONS not defined</option>
                                {% endif %}
                            </select>
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>
                    
                    <div id="imagePreview" class="text-center mt-3" style="display: none;">
                        <img id="previewImg" class="img-fluid border rounded" style="max-height: 300px;">
                    </div>
                </div>
            </div>

            <!-- Content Classification Section -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">üìù Content Classification</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="meme_content" class="form-label">Content Description <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="meme_content" name="meme_content" 
                                      rows="3" placeholder="Describe what is happening in this meme (literal content, characters, setting, etc.)" required>{{ form_data.meme_content if form_data else '' }}</textarea>
                            <div class="invalid-feedback"></div>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label for="cultural_references" class="form-label">Cultural/Pop Culture References <span class="text-muted">(if any)</span></label>
                            <textarea class="form-control" id="cultural_references" name="cultural_references" 
                                      rows="2" placeholder="Movies, TV shows, celebrities, events, trends, etc. that this meme references">{{ form_data.cultural_references if form_data else '' }}</textarea>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="meme_template" class="form-label">Meme Template/Format <span class="text-muted">(if applicable)</span></label>
                            <input type="text" class="form-control" id="meme_template" name="meme_template" 
                                   placeholder="e.g., Drake pointing, Distracted boyfriend, etc." value="{{ form_data.meme_template if form_data else '' }}">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="context_required" class="form-label">Context Knowledge Required <span class="text-danger">*</span></label>
                            <select class="form-select" id="context_required" name="context_required" required>
                                <option value="">Select level...</option>
                                {% if config.CONTEXT_LEVELS is defined %}
                                    {% for key, value in config.CONTEXT_LEVELS.items() %}
                                        <option value="{{ key }}" {{ 'selected' if form_data and form_data.context_required == key else '' }}>
                                            {{ value }}
                                        </option>
                                    {% endfor %}
                                {% else %}
                                    <option value="Unknown" selected>Error: CONTEXT_LEVELS not defined</option>
                                {% endif %}
                            </select>
                            <div class="invalid-feedback"></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="estimated_year" class="form-label">Estimated Year/Era <span class="text-danger">*</span></label>
                            <select class="form-select" id="estimated_year" name="estimated_year" required>
                                <option value="">Select year range...</option>
                                {% if config.TIME_RANGE_OPTIONS is defined %}
                                    {% for option in config.TIME_RANGE_OPTIONS %}
                                        <option value="{{ option }}" {{ 'selected' if form_data and form_data.estimated_year == option else '' }}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                {% else %}
                                    <option value="Unknown" selected>Error: TIME_RANGE_OPTIONS not defined</option>
                                {% endif %}
                            </select>
                            <div class="invalid-feedback"></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="cultural_reach" class="form-label">Cultural Reach <span class="text-danger">*</span></label>
                            <select class="form-select" id="cultural_reach" name="cultural_reach" required>
                                <option value="">Select reach...</option>
                                {% if config.CULTURAL_REACH_OPTIONS is defined %}
                                    {% for key, value in config.CULTURAL_REACH_OPTIONS.items() %}
                                        <option value="{{ key }}" {{ 'selected' if form_data and form_data.cultural_reach == key else '' }}>
                                            {{ value }}
                                        </option>
                                    {% endfor %}
                                {% else %}
                                    <option value="Unknown" selected>Error: CULTURAL_REACH_OPTIONS not defined</option>
                                {% endif %}
                            </select>
                            <div class="invalid-feedback"></div>
                        </div>

                        <div class="col-md-6 mb-3" id="niche-community-group" style="{{ 'display: block;' if form_data and form_data.cultural_reach == 'Niche Community' else 'display: none;' }}">
                            <label for="niche_community" class="form-label">Niche Community <span id="niche-required" class="text-danger" style="{{ 'display: inline;' if form_data and form_data.cultural_reach == 'Niche Community' else 'display: none;' }}">*</span></label>
                            <input type="text" class="form-control" id="niche_community" name="niche_community" 
                                   placeholder="e.g., Gaming, Tech, Sports, Academic, etc." value="{{ form_data.niche_community if form_data else '' }}">
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Humor & Emotion Analysis Section -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">üòÑ Humor & Emotional Analysis</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="humor_explanation" class="form-label">Why is this humorous/relatable? <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="humor_explanation" name="humor_explanation" 
                                      rows="3" placeholder="Explain the joke, irony, relatability, or what makes this meme funny/engaging" required>{{ form_data.humor_explanation if form_data else '' }}</textarea>
                            <div class="invalid-feedback"></div>
                        </div>
                        
                        <!-- Humor Type Selection -->
                        <div class="mb-4">
                            <h5 class="card-title">üòÑ What type of humor does this meme have?</h5>
                            <p class="card-text small text-muted mb-3">Select the humor type that best describes this meme:</p>
                            
                            <div class="row">
                                {% if config.HUMOR_TYPES is defined %}
                                    {% if config.HUMOR_TYPES %}
                                        {% for humor in config.HUMOR_TYPES %}
                                            <div class="col-md-4 mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="humor_type" 
                                                        value="{{ humor.type }}" id="humor_{{ loop.index }}"
                                                        {{ 'checked' if form_data and form_data.humor_type == humor.type else '' }} required>
                                                    <label class="form-check-label" for="humor_{{ loop.index }}">
                                                        <strong>{{ humor.type }}</strong>
                                                        {% if humor.description %}
                                                            <br><small class="text-muted" title="{{ humor.description }}" data-bs-toggle="tooltip">{{ humor.description }}</small>
                                                        {% endif %}
                                                    </label>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-warning">config.HUMOR_TYPES is empty. Please check configuration.</p>
                                    {% endif %}
                                {% else %}
                                    <p class="text-danger">Error: config.HUMOR_TYPES is not defined in the template context.</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Emotions Selection -->
                        <div class="mb-4">
                            <h5 class="card-title">üòä What emotions does this meme convey?</h5>
                            <p class="card-text small text-muted mb-3">Select all emotions that apply (you can choose multiple):</p>
                            
                            <div class="row">
                                {% if config.EMOTIONS_TYPES is defined %}
                                    {% if config.EMOTIONS_TYPES %}
                                        {% for emotion in config.EMOTIONS_TYPES %}
                                            <div class="col-md-6 mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="emotions[]" 
                                                        value="{{ emotion.emotion }}" id="emotion_{{ loop.index }}"
                                                        {{ 'checked' if form_data and form_data.emotions and emotion.emotion in form_data.emotions else '' }}>
                                                    <label class="form-check-label" for="emotion_{{ loop.index }}">
                                                        {% if emotion.emoji %}<span class="me-1">{{ emotion.emoji }}</span>{% endif %}
                                                        <strong>{{ emotion.emotion }}</strong>
                                                        {% if emotion.description %}
                                                            <br><small class="text-muted" title="{{ emotion.description }}" data-bs-toggle="tooltip">{{ emotion.description }}</small>
                                                        {% endif %}
                                                    </label>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-warning">config.EMOTIONS_TYPES is empty. Please check configuration.</p>
                                    {% endif %}
                                {% else %}
                                    <p class="text-danger">Error: config.EMOTIONS_TYPES is not defined in the template context.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
           
            <!-- Additional Notes Section -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <label for="additional_notes" class="form-label">Additional Notes <span class="text-muted">(optional)</span></label>
                    <textarea class="form-control" id="additional_notes" name="additional_notes" 
                              rows="3" placeholder="Any additional context, variations, or notes about this meme">{{ form_data.additional_notes if form_data else '' }}</textarea>
                </div>
            </div>
            
            <!-- Terms Agreement -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="terms_agreement" name="terms_agreement" required {{ 'checked' if form_data and form_data.terms_agreement else '' }}>
                        <label class="form-check-label" for="terms_agreement">
                            <strong>I agree that:</strong> I have the right to share this image, it doesn't violate copyright, 
                            and I consent to its use for research purposes by THWS and CAIRO. <span class="text-danger">*</span>
                        </label>
                        <div class="invalid-feedback"></div>
                    </div>
                </div>
            </div>
            
            <!-- Submit Button -->
            <div class="text-center mb-4">
                <button type="submit" class="btn btn-primary btn-lg px-5" id="submitBtn">
                    üöÄ Submit Meme Classification
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Login Modal for anonymous users -->
{% if not current_user %}
<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üîë Sign In</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Enter your email to get a login link:</p>
                <form method="post" action="{{ url_for('auth.request_login') }}">
                    <div class="mb-3">
                        <input type="email" class="form-control" name="login_email" placeholder="your@email.com" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Send Login Link</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <small class="text-muted">
                    Don't have an account? <a href="{{ url_for('auth.register') }}">Register here</a>
                </small>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('memeUploadForm');
    const submitBtn = document.getElementById('submitBtn');
    const alertsContainer = document.getElementById('validation-alerts');
    
    // Image preview functionality
    document.getElementById('file').addEventListener('change', function(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        
        if (file) {
            // Validate file size (16MB limit)
            if (file.size > 16 * 1024 * 1024) {
                showFieldError('file', 'File size must be less than 16MB');
                this.value = '';
                preview.style.display = 'none';
                return;
            }
            
            // Validate file type
            const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showFieldError('file', 'Please select a valid image file (PNG, JPG, JPEG, or WebP)');
                this.value = '';
                preview.style.display = 'none';
                return;
            }
            
            // Clear any previous error and show preview
            clearFieldError('file');
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            preview.style.display = 'none';
        }
    });
    
    // Dynamic form interactions
    document.getElementById('cultural_reach').addEventListener('change', function() {
        const nicheGroup = document.getElementById('niche-community-group');
        const nicheField = document.getElementById('niche_community');
        const nicheRequired = document.getElementById('niche-required');
        
        if (this.value === 'Niche Community') {
            nicheGroup.style.display = 'block';
            nicheField.required = true;
            nicheRequired.style.display = 'inline';
        } else {
            nicheGroup.style.display = 'none';
            nicheField.required = false;
            nicheRequired.style.display = 'none';
            clearFieldError('niche_community');
        }
    });
    
    // Real-time validation for required fields
    const requiredFields = ['file', 'platform_found', 'meme_content', 'estimated_year', 'cultural_reach', 
                           'humor_explanation', 'humor_type', 'context_required','meme_origin_country',
                        'contributor_country'];
    
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            field.addEventListener('blur', function() {
                validateField(fieldId);
            });
            
            // Clear error on input
            field.addEventListener('input', function() {
                if (this.classList.contains('is-invalid')) {
                    clearFieldError(fieldId);
                }
            });
        }
    });
    
    // Form submission with comprehensive validation
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Clear previous alerts and errors
        clearAllErrors();
        
        const errors = [];
        let isValid = true;
        
        // Validate required fields
        requiredFields.forEach(fieldId => {
            if (!validateField(fieldId)) {
                isValid = false;
            }
        });
        
        // Special validation for anonymous users
        if (!{{ 'true' if current_user else 'false' }}) {
            if (!validateField('contributor_country')) {
                isValid = false;
            }
        }
        
        // Validate emotions
        const emotions = document.querySelectorAll('input[name="emotions[]"]:checked');
        if (emotions.length === 0) {
            showFieldError('emotions-container', 'Please select at least one emotion');
            errors.push('Please select at least one emotion');
            isValid = false;
        }
        
        // Validate terms agreement
        const termsCheckbox = document.getElementById('terms_agreement');
        if (!termsCheckbox.checked) {
            showFieldError('terms_agreement', 'You must agree to the terms to upload');
            errors.push('You must agree to the terms');
            isValid = false;
        }
        
        // Validate niche community if "Niche Community" is selected
        const culturalReach = document.getElementById('cultural_reach').value;
        if (culturalReach === 'Niche Community') {
            if (!validateField('niche_community')) {
                isValid = false;
                errors.push('Please specify the niche community');
            }
        }
        
        // If there are validation errors, show them and don't submit
        if (!isValid) {
            showValidationAlert(errors);
            
            // Scroll to first error
            const firstErrorField = document.querySelector('.is-invalid');
            if (firstErrorField) {
                firstErrorField.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }
            
            return false;
        }
        
        // If validation passes, show loading state and submit
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Uploading...';
        submitBtn.disabled = true;
        
        // Submit the form
        this.submit();
    });
    
    function validateField(fieldId) {
        const field = document.getElementById(fieldId);
        if (!field) return true;
        
        let isValid = true;
        let errorMessage = '';
        
        if (field.hasAttribute('required') && !field.value.trim()) {
            isValid = false;
            errorMessage = `${getFieldLabel(fieldId)} is required`;
        }
        
        if (isValid) {
            clearFieldError(fieldId);
        } else {
            showFieldError(fieldId, errorMessage);
        }
        
        return isValid;
    }
    
    function showFieldError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const feedback = field ? field.parentElement.querySelector('.invalid-feedback') : null;
        
        if (field) {
            field.classList.add('is-invalid');
        }
        
        if (feedback) {
            feedback.textContent = message;
            feedback.style.display = 'block';
        }
    }
    
    function clearFieldError(fieldId) {
        const field = document.getElementById(fieldId);
        const feedback = field ? field.parentElement.querySelector('.invalid-feedback') : null;
        
        if (field) {
            field.classList.remove('is-invalid');
        }
        
        if (feedback) {
            feedback.textContent = '';
            feedback.style.display = 'none';
        }
    }
    
    function clearAllErrors() {
        document.querySelectorAll('.is-invalid').forEach(field => {
            field.classList.remove('is-invalid');
        });
        
        document.querySelectorAll('.invalid-feedback').forEach(feedback => {
            feedback.textContent = '';
            feedback.style.display = 'none';
        });
        
        alertsContainer.innerHTML = '';
    }
    
    function showValidationAlert(errors) {
        const alertHtml = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <h6><i class="bi bi-exclamation-triangle"></i> Please fix the following issues:</h6>
                <ul class="mb-0 ps-3">
                    ${errors.map(error => `<li>${error}</li>`).join('')}
                </ul>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        alertsContainer.innerHTML = alertHtml;
        alertsContainer.scrollIntoView({ behavior: 'smooth' });
    }
    
    function getFieldLabel(fieldId) {
        const labels = {
            'file': 'Image file',
            'contributor_country': 'Country',
            'platform_found': 'Platform where found',
            'meme_origin_country': 'Country where Meme was found',
            'meme_content': 'Content description',
            'estimated_year': 'Estimated year',
            'cultural_reach': 'Cultural reach',
            'niche_community': 'Niche community',
            'humor_explanation': 'Humor explanation',
            'humor_type': 'Humor type',
            'context_required': 'Context required'
        };
        return labels[fieldId] || fieldId.replace('_', ' ');
    }
    
    // Auto-save form data to sessionStorage (as backup)
    function saveFormData() {
        const formData = new FormData(form);
        const data = {};
        
        for (let [key, value] of formData.entries()) {
            if (key === 'emotions[]') {
                if (!data.emotions) data.emotions = [];
                data.emotions.push(value);
            } else if (key !== 'file') {  // Don't save file data
                data[key] = value;
            }
        }
        
        sessionStorage.setItem('memeUploadForm', JSON.stringify(data));
    }
    
    // Save form data periodically
    setInterval(saveFormData, 30000); // Save every 30 seconds
    
    // Save on form changes
    form.addEventListener('input', saveFormData);
    form.addEventListener('change', saveFormData);
});
</script>

<style>
/* Custom styles for improved validation UX */
.is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
}

.invalid-feedback {
    display: none;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875em;
    color: #dc3545;
}

.invalid-feedback.d-block {
    display: block !important;
}

/* Enhanced form styling */
.form-check-input:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.card-header {
    font-weight: 600;
}

.form-label {
    font-weight: 500;
    margin-bottom: 0.5rem;
}

/* Image preview styling */
#imagePreview {
    margin-top: 1rem;
    padding: 1rem;
    background-color: #f8f9fa;
    border-radius: 0.375rem;
}

#previewImg {
    border: 2px solid #dee2e6;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Loading button animation */
.spinner-border-sm {
    width: 1rem;
    height: 1rem;
}

/* Alert styling */
.alert ul {
    margin-bottom: 0;
}

.alert ul li {
    margin-bottom: 0.25rem;
}

/* Responsive improvements */
@media (max-width: 768px) {
    .card-header h4 {
        font-size: 1.1rem;
    }
    
    .lead {
        font-size: 1rem;
    }
    
    .btn-lg {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
    }
}

/* Focus improvements for accessibility */
.form-control:focus,
.form-select:focus {
    border-color: #86b7fe;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.form-check-input:focus {
    border-color: #86b7fe;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* Smooth transitions */
.card,
.form-control,
.form-select,
.btn {
    transition: all 0.15s ease-in-out;
}

/* Improved checkbox styling */
.form-check {
    margin-bottom: 0.5rem;
}

.form-check-label {
    cursor: pointer;
    font-weight: 400;
}

/* Enhanced submit button */
#submitBtn {
    min-width: 200px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

#submitBtn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#submitBtn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}
</style>
{% endblock %}