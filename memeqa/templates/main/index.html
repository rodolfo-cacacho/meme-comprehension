{% extends "base.html" %}

{% block title %}Home - MemeQA Enhanced{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="text-center mb-5">
            <h1 class="display-4 mb-4">üé≠ LLMs Last Test: Memes üòÇ</h1>
            {% if app_session.current_user %}
                <p class="lead">Welcome back, <strong>{{ app_session.name.split()[0] }}</strong>! Ready to advance meme AI research?</p>
            {% else %}
                <p class="lead">Help us create the ultimate meme understanding dataset for AI research!</p>
            {% endif %}
        </div>
        
        <!-- Hero meme image -->
        <div class="card shadow-sm mb-4">
            <div class="card-body text-center">
                <h5 class="lead">Help us create the ultimate meme understanding dataset!</h5>
                <img src="static/1ycxgw.jpg" 
                class="meme-img mb-3" 
                alt="Gives us your memes">
            </div>
        </div>
        <!-- UPDATED: How it works section with current functionality -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h3 class="card-title">üöÄ How it works:</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="text-center">
                            <div class="display-1 mb-2">üß†</div>
                            <h5>Evaluate Memes</h5>
                            <p class="small text-muted">Analyze memes by identifying their humor types, emotions conveyed, and cultural context. Help us understand what makes memes funny across cultures!</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="text-center">
                            <div class="display-1 mb-2">üìù</div>
                            <h5>Upload & Classify</h5>
                            <p class="small text-muted">Share your memes with detailed classifications including humor analysis, emotional mapping, cultural reach, and temporal context.</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="text-center">
                            <div class="display-1 mb-2">üî¨</div>
                            <h5>Advance Research</h5>
                            <p class="small text-muted">Your contributions help create benchmark datasets for evaluating AI understanding of internet humor, cultural references, and multimodal reasoning in memes.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Research Information Box -->
        <div class="card shadow-sm mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üìö About This Research</h4>
            </div>
            <div class="card-body">
                <h5 class="card-title">What is MemeQA Enhanced?</h5>
                <p class="card-text">
                    MemeQA is a comprehensive crowd-sourced meme understanding dataset designed to evaluate Vision-Language Models (VLMs) 
                    in their comprehension of internet memes and human humor. This enhanced version includes detailed cultural classifications,
                    humor analysis, emotional mappings, and temporal context to create the most comprehensive meme research dataset available.
                </p>
                
                <p class="card-text">
                    The dataset is being developed by researchers at <strong>THWS (Technische Hochschule W√ºrzburg-Schweinfurt)</strong> 
                    and <strong>CAIRO (Center for AI and Robotics)</strong> to address the growing need for AI systems that can 
                    understand not just what they see, but the cultural and humorous context behind visual content.
                </p>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6><strong>Research Goals:</strong></h6>
                        <ul class="mb-0">
                            <li>Evaluate VLM meme comprehension</li>
                            <li>Benchmark humor understanding in AI</li>
                            <li>Create diverse cultural context dataset</li>
                            <li>Enable explainable meme analysis</li>
                            <li>Study cross-cultural humor patterns</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><strong>Enhanced Features:</strong></h6>
                        <ul class="mb-0">
                            <li>15+ classification dimensions per meme</li>
                            <li>Emotional and humor type analysis</li>
                            <li>Cultural reach & platform tracking</li>
                            <li>Temporal meme evolution data</li>
                            <li>User performance analytics</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-3">
                    <small class="text-muted">
                        <strong>Institutions:</strong> THWS (Technische Hochschule W√ºrzburg-Schweinfurt) ‚Ä¢ CAIRO (Center for AI and Robotics)
                    </small>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="card-title mb-0">üìä Your Progress</h4>
                    {% if app_session.current_user %}
                        <div class="text-end">
                            <small class="text-muted">Registered User</small>
                            <div class="user-avatar bg-success text-white ms-2" style="width: 24px; height: 24px; font-size: 12px;">
                                {{ app_session.name[:1].upper() }}
                            </div>
                        </div>
                    {% else %}
                        <a href="{{ url_for('auth.register') }}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-person-plus"></i> Join Research
                        </a>
                    {% endif %}
                </div>
                
                <!-- Progress Bar Section -->
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><strong>Evaluations completed:</strong></span>
                        {% if app_session.current_user %}
                            {% if app_session.get_available_memes() > 0 %}
                                <span class="badge bg-primary fs-6">{{ app_session.eval_count }}/{{ app_session.get_available_memes() }}</span>
                            {% else %}
                                <span class="badge bg-secondary fs-6">All done!</span>
                            {% endif %}
                        {% else %}
                            {% set max_evals = [app_session.max_eval, app_session.get_available_memes()]|min %}
                            <span class="badge bg-primary fs-6">{{ eval_count }}/{{ max_evals }}</span>
                        {% endif %}
                    </div>
                    
                    <!-- Progress Bar with Button -->
                    <div class="row align-items-center">
                        <div class="col-9">
                            <div class="progress" style="height: 30px;">
                                {% if app_session.current_user %}
                                    {% set total_possible = app_session.get_available_memes() %}
                                    {% if total_possible > 0 %}
                                        <div class="progress-bar" role="progressbar" 
                                            style="width: {{ (app_session.eval_count/total_possible*100)|round }}%">
                                            {{ app_session.eval_count }}/{{ total_possible }}
                                        </div>
                                    {% else %}
                                        <div class="progress-bar bg-secondary" role="progressbar" style="width: 100%">
                                            No evaluations available
                                        </div>
                                    {% endif %}
                                {% else %}
                                    {% set max_evals = [app_session.max_eval, app_session.get_available_memes()]|min %}
                                    <div class="progress-bar" role="progressbar" 
                                        style="width: {{ (app_session.eval_count/max_evals*100)|round if max_evals > 0 else 0 }}%">
                                        {{ app_session.eval_count }}/{{ max_evals }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-3 text-end">
                            {% if app_session.current_user %}
                                <!-- Registered user: always show evaluate button if memes available -->
                                {% set available_memes = app_session.get_available_memes() %}
                                {% if available_memes > 0 %}
                                    <a href="{{ url_for('evaluations.evaluate') }}" class="btn btn-primary btn-sm">
                                        <i class="bi bi-play"></i> Evaluate
                                    </a>
                                {% else %}
                                    <a href="{{ url_for('memes.upload_file') }}" class="btn btn-success btn-sm">
                                        <i class="bi bi-upload"></i> Upload
                                    </a>
                                {% endif %}
                            {% else %}
                                <!-- Anonymous user: conditional button based on limits -->
                                {% set max_evals = [app_session.max_eval, app_session.get_available_memes()]|min %}
                                {% if app_session.eval_count < max_evals and max_evals > 0 %}
                                    <a href="{{ url_for('evaluations.evaluate') }}" class="btn btn-primary btn-sm">
                                        <i class="bi bi-play"></i> Evaluate
                                    </a>
                                {% elif app_session.upload_count < app_session.max_upload %}
                                    <a href="{{ url_for('memes.upload_file') }}" class="btn btn-success btn-sm">
                                        <i class="bi bi-upload"></i> Upload
                                    </a>
                                {% else %}
                                    <a href="{{ url_for('auth.register') }}" class="btn btn-warning btn-sm">
                                        <i class="bi bi-person-plus"></i> Register
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- User Stats (for registered users only) -->
                {% if app_session.current_user %}
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="border rounded p-2">
                                <div class="h4 text-primary mb-1">{{ app_session.upload_count or 0 }}</div>
                                <small class="text-muted">Memes Uploaded</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded p-2">
                                <div class="h4 text-success mb-1">{{ app_session.eval_count or 0 }}</div>
                                <small class="text-muted">Total Evaluations</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border rounded p-2">
                                <div class="h4 text-info mb-1">
                                    {% if app_session.evaluation_accuracy %}
                                        {{ "%.0f"|format(app_session.evaluation_accuracy * 100) }}%
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                                <small class="text-muted">Accuracy</small>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        {% if app_session.current_user %}
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h4 class="card-title mb-4">üèÜ Leaderboards</h4>

                <div class="row">
                    <!-- Top Uploaders -->
                    <div class="col-md-6 mb-3">
                        <div class="leaderboard-card border rounded p-3 h-100">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-cloud-upload"></i> Top Meme Contributors
                            </h5>
                            <table class="table table-sm leaderboard-table mb-0">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>User</th>
                                        <th>Uploads</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for u in top_uploaders %}
                                    <tr>
                                        <td>
                                            <strong>
                                                {% if loop.index == 1 %}ü•á{% elif loop.index == 2 %}ü•à{% elif loop.index == 3 %}ü•â{% else %}{{ loop.index }}{% endif %}
                                            </strong>
                                        </td>
                                        <td>{{ u.name }}</td>
                                        <td class="text-end text-primary"><strong>{{ u.total_submissions }}</strong></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% if not top_uploaders %}
                                <p class="text-muted small">No uploads yet.</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Top Evaluators -->
                    <div class="col-md-6 mb-3">
                        <div class="leaderboard-card border rounded p-3 h-100">
                            <h5 class="text-success mb-3">
                                <i class="bi bi-clipboard-check"></i> Top Evaluators
                            </h5>
                            <table class="table table-sm leaderboard-table mb-0">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>User</th>
                                        <th>Evaluations</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for e in top_evaluators %}
                                    <tr>
                                        <td>
                                            <strong>
                                                {% if loop.index == 1 %}ü•á{% elif loop.index == 2 %}ü•à{% elif loop.index == 3 %}ü•â{% else %}{{ loop.index }}{% endif %}
                                            </strong>
                                        </td>
                                        <td>{{ e.name }}</td>
                                        <td class="text-end text-success"><strong>{{ e.total_evaluations }}</strong></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% if not top_evaluators %}
                                <p class="text-muted small">No evaluations yet.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
        .leaderboard-card {
            background: white;
            transition: transform .2s ease-in-out;
        }

        .leaderboard-card:hover {
            transform: translateY(-2px);
        }

        .leaderboard-table tbody tr:hover {
            background: rgba(0,0,0,0.03);
        }

        .leaderboard-avatar {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: #6c63ff;
            color: white;
            font-size: 12px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        </style>
        {% endif %}

        <!-- Quick Actions -->
        <div class="row text-center mb-4">
            <div class="{% if development %}col-md-3{% else %}col-md-4{% endif %} mb-3">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <div class="display-4 text-primary mb-3">üìä</div>
                        <h5 class="card-title">View Gallery</h5>
                        <p class="card-text small">Browse all submitted memes and their detailed classifications</p>
                        <a href="{{ url_for('memes.gallery') }}" class="btn btn-outline-primary">
                            <i class="bi bi-images"></i> Browse Memes
                        </a>
                    </div>
                </div>
            </div>
            <div class="{% if development %}col-md-3{% else %}col-md-4{% endif %} mb-3">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <div class="display-4 text-success mb-3">üìà</div>
                        <h5 class="card-title">Statistics</h5>
                        <p class="card-text small">See dataset statistics and contributor metrics</p>
                        <a href="{{ url_for('main.stats') }}" class="btn btn-outline-success">
                            <i class="bi bi-bar-chart"></i> View Stats
                        </a>
                    </div>
                </div>
            </div>
            {% if app_session.current_user %}
                <div class="{% if development %}col-md-3{% else %}col-md-4{% endif %} mb-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <div class="display-4 text-info mb-3">üë§</div>
                            <h5 class="card-title">Your Profile</h5>
                            <p class="card-text small">View your contributions and performance analytics</p>
                            <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-info">
                                <i class="bi bi-person"></i> View Profile
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="{% if development %}col-md-3{% else %}col-md-4{% endif %} mb-3">
                    <div class="card h-100 shadow-sm border-warning">
                        <div class="card-body">
                            <div class="display-4 text-warning mb-3">üéì</div>
                            <h5 class="card-title">Join Research</h5>
                            <p class="card-text small">Register to track contributions and get research updates</p>
                            <a href="{{ url_for('auth.register') }}" class="btn btn-warning">
                                <i class="bi bi-person-plus"></i> Register
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if development %}
            <div class="col-md-3 mb-3">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <div class="display-4 text-secondary mb-3">üîß</div>
                        <h5 class="card-title">Dev Tools</h5>
                        <p class="card-text small">Analytics dashboard and data export (dev only)</p>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('main.analytics') }}" class="btn btn-outline-secondary btn-sm">
                                <i class="bi bi-graph-up"></i> Analytics
                            </a>
                            <a href="{{ url_for('main.reset_session') }}" class="btn btn-outline-secondary btn-sm">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.user-avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-weight: bold;
}

.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-2px);
}

.bg-gradient {
    position: relative;
    overflow: hidden;
}

.bg-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    pointer-events: none;
}
</style>
{% endblock %}